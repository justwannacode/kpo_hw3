from __future__ import annotations

import re
from collections import Counter

# Набор стоп-слов для более осмысленного облака слов
STOPWORDS = {
    "и","в","во","не","что","он","на","я","с","со","как","а","то","все","она","так",
    "его","но","да","ты","к","у","же","вы","за","бы","по","только","ее","мне","было",
    "вот","от","меня","еще","нет","о","из","ему","теперь","когда","даже","ну","вдруг",
    "ли","если","уже","или","ни","быть","был","него","до","вас","нибудь","опять","уж",
    "вам","ведь","там","потом","себя","ничего","ей","может","они","тут","где","есть",
    "над","ней","для","мы","тебя","их","чем","была","сам","чтоб","без","будто","чего",
    "раз","тоже","себе","под","будет","ж","тогда","кто","этот","того","потому","этого",
}


_word_re = re.compile(r"[A-Za-zА-Яа-яЁё]{2,}")


def extract_words(text: str) -> list[str]:
    words = [w.lower() for w in _word_re.findall(text)]
    words = [w for w in words if w not in STOPWORDS]
    return words


def top_words(words: list[str], limit: int = 30) -> list[dict]:
    c = Counter(words)
    return [{"word": w, "count": n} for (w, n) in c.most_common(limit)]
